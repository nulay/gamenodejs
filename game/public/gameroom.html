<html>
    <head>
        <title>Login Here</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type="text/javascript" src="public/YConsole-compiled.js"></script>
<script type="text/javascript" >YConsole.show();</script>
    </head>
    <body class="container">
        <div class="page-header">
            <h1>Game Room</h1>
        </div>

        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="/">Home</a></li>
                        <li><a href="/signup">Sign Up</a></li>
                        <li><a href="/dashboard">Dashboard</a></li>
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="/login">Log In</a></li>
                        <li><a href="/logout">Log Out</a></li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>



<div style="margin: 20px">
    <div class="creategame" style="display:none;">
        <button value="создать игру" id="butCreateGame">создать игру</button>
        <div id="silImg" style="margin:5px 15px;"></div>
    </div>
</div>

<div id="listGames" style="min-height: 500px;">

</div>

<script type="application/javascript">
    var objRoom={
        countUs:2,
        init:function(){
            var thisEl=this;
            var imgSel=$('<img src="/game/public/images/siluetsel.png" width="20"/>').attr("ind","2");
            jQuery('#silImg').append(imgSel).append(imgSel.clone().attr("ind","2")).append(imgSel.clone().attr("ind","3")).append(imgSel.clone().attr("ind","4"));
            this.unsel(2);
            $('#silImg img').click(function(el){thisEl.unsel(parseInt($(el.target).attr('ind')))});
            this.loadAllGame();
            this.loadUserData();
            $('#butCreateGame').click(function(){
                thisEl.createGame();
            });
        },
        unselSiluet:function(el,ind){
            if(ind==0){
                unsel(ind);
            }
        },
        unsel:function(ind){
            this.countUs=ind;
            var mi=$("#silImg img");
            mi.attr('src','/game/public/images/siluetsel.png');
            for(var i=ind;i<mi.length;i++){
                $(mi[i]).attr('src','/game/public/images/siluet.png');
            }
        },
        loadUserData:function(){
            return;
            var thisEl=this;
            jQuery.ajax({
                url:"/games/room/userdata",
                dataType:"json",
                type:"GET"
            }).done(function (data) {
                if(data!=null){
//                    if(data.activeRooms.length>0){
//                         $('#butCreateGame').attr("disabled","disabled");
//                    }
                }
            }).always(function(){
                setTimeout(function(){thisEl.loadUserData()},3000);
            });
        },
        loadAllGame:function(){
            var thisEl=this;
            jQuery.ajax({
                url:"/games/room/getAllRoom",
                dataType:"json",
                type:"GET"
            }).done(function (data) {
                if(data!=null){
                    for(var i=0;i<data.length;i++){
                        var buttonD=$('<button value="Присоединится">Присоединится</button>');
                        var elD=$('<div><input type="hidden" value="'+data[i].numberRoom+'"><span>'+data[i].typeRoom+' #'+(parseInt(data[i].numberRoom)+1)+' ('+data[i].countUsers+'/'+data[i].maxCountUser+') '+'</span></div>');
                        elD.append(buttonD);
                        $('#listGames').empty().append(elD);
                        thisEl.createCl(buttonD,data[i].numberRoom);
                    }
                }else{
                    jQuery('#listGames').empty().append('<div>hello</div>');
                }
            }).always(function(){
                setTimeout(function(){thisEl.loadAllGame()},3000);
            });
        }, 
        createCl:function(buttonD,numberRoom){
            var thisEl=this;
            buttonD.click(function(){thisEl.joinRoom(numberRoom);});
        },
        createGame:function(){
            document.location.href="/games/monopoly/createroom.html?countgameuser="+this.countUs;
        },
        joinRoom:function(numberRoom){
            document.location.href="/games/monopoly/"+numberRoom+"/joinRoom.html";
        }
    }
    $(function(){
        objRoom.init();
    })
</script>
  </body>
</html>      



